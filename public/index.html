<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="manifest" href="/images/site.webmanifest">
    <link rel="stylesheet" href="./main.scss">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script
        src="https://www.google.com/recaptcha/enterprise.js?render=6LeZUe8lAAAAALuM_bjvYMlBanNAeG_s4lulVkT_"></script>
    <script src="./index.jsx" type="module"></script>
    <script>

        // Store in the session storage
        const result = "<%= productList %>";
        sessionStorage.setItem('productList', result);

        const launchType = "<%= launchType %>";
        sessionStorage.setItem('launchType', launchType);

        const userData = "<%= userData %>";
        sessionStorage.setItem('userData', userData);

        const retailerData = "<%= retailerData %>";
        sessionStorage.setItem('retailerData', retailerData);

        // Consume product list
        const jsonData = sessionStorage.getItem('productList');
        const removed = result.replace(/&#34;/g, '"');
        try {
            global.json = JSON.parse(removed);
        } catch (e) { }

        // Store session token
        const token = "<%= token %>";
        sessionStorage.setItem('authToken', token);

    </script>
    <!-- Google Tag Manager -->
    <script>
        function initializeGoogleAnalytics() {
            // Get the consent status from the local storage
            var consent = localStorage.getItem("cookie-consent");

            if (consent === "true") {
                // Enable GTM
                var gtmScript = document.createElement('script');
                gtmScript.async = true;
                gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-WPMXCTK';
                var gtmNoScript = document.createElement('noscript');
                var gtmIframe = document.createElement('iframe');
                gtmIframe.src = 'https://www.googletagmanager.com/ns.html?id=GTM-WPMXCTK';
                gtmIframe.height = "0";
                gtmIframe.width = "0";
                gtmIframe.style.display = "none";
                gtmIframe.style.visibility = "hidden";
                gtmNoScript.appendChild(gtmIframe);
                document.head.appendChild(gtmScript);
                document.body.appendChild(gtmNoScript);
                console.log("Google Tag Manager enabled");
            } else {
                // Disable Google Tag Manager tracking
                console.log("Google Tag Manager disabled");

                // Disable GTM
                window["ga-disable-GTM-WPMXCTK"] = true;
            }
        }

        function handleCookieConsent(consent) {
            if (consent) {
                // User accepted the cookie consent
                localStorage.setItem("cookie-consent", "true");
                initializeGoogleAnalytics(); // Update Google Tag Manager and GTM tracking
            } else {
                // User declined the cookie consent
                localStorage.setItem("cookie-consent", "false");
                // You might want to consider disabling or removing any cookies that were set before
            }

            // Fade out the cookie consent banner
            var cookieBanner = document.getElementById("cookie-consent");
            cookieBanner.classList.add("fade-out");
        }

    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C3L952ZLCZ"></script>
    <title>Emays</title>
</head>

<body>
    <!-- Cookie consent banner or popup -->
    <div id="cookie-consent">
        <div>
            <p>üç™ This website automatically uses only cookies and similar technologies for its operation and for basic settings.
                It is also possible to consent to the use of optional cookies that provide useful and personalized functions and/or targeted advertising.
                By clicking on "Accept" you are consenting to the use of cookies for all the purposes described in our <a href="/#/cookie">Cookie Policy</a>.</p>
        </div>
        <div class="btn-contains">
            <button id="accept-cookie" class="op-color" onclick="handleCookieConsent(true)"
                style="margin-right: 1%;">Accept</button>
            <button id="decline-cookie" class="op-color"
                onclick="handleCookieConsent(false)">Decline</button>
        </div>
    </div>
    <div id="app"></div>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(
                    (registration) => {
                        if (!navigator.serviceWorker.controller) {
                            return;
                        }
                        registration.update();
                        registration.waiting.postMessage('skipWaiting');
                    },
                    (err) => {
                        console.log('ServiceWorker registration failed:', err);
                    }
                );
            });
        }
    </script>
    <script>
        window.addEventListener("load", initializeGoogleAnalytics);
        document.addEventListener("DOMContentLoaded", function () {
            // Check the consent status on page load
            var consent = localStorage.getItem("cookie-consent");
            if (consent) { // Check if consent is "true"
                var cookieBanner = document.getElementById("cookie-consent");
                setTimeout(function () {
                    cookieBanner.classList.add("fade-out");
                }, 50);
            }
        });
    </script>
</body>

</html>